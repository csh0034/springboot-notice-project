<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ask.project.api.notice.service.impl.NoticeMapper">

	<sql id="notice-cols">
		NOTICE_ID,
		TITLE,
		CONTENT,
		READ_CNT,
		ATTACHMENT_GROUP_ID,
		COMPLETED,
		CREATOR_ID,
		( SELECT USER_NM FROM COMT_USER WHERE USER_ID = CREATOR_ID ) CREATOR_NM,
		CREATED_DT,
		UPDATER_ID,
		( SELECT USER_NM FROM COMT_USER WHERE USER_ID = UPDATER_ID ) UPDATER_NM,
		UPDATED_DT
	</sql>

	<sql id="notice-where">
		AND COMPLETED = 1
		<if test="title != null and title.length() > 0">
			AND TITLE LIKE CONCAT('%', #{title}, '%')
		</if>
		<if test="beginDt != null">
			<![CDATA[
				AND CREATED_DT >= #{beginDt}
			]]>
		</if>
		<if test="endDt != null">
			<![CDATA[
				AND CREATED_DT <= DATEADD('DAY', 1, #{endDt})
			]]>
		</if>
	</sql>

	<select id="selectNoticeListCount" resultType="Long">
		/* NoticeMapper.selectNoticeListCount */
		SELECT
			COUNT(*)
		FROM
			COMT_NOTICE
		WHERE
			1=1
			<include refid="notice-where" />
	</select>

	<select id="selectNoticeList" resultType="com.ask.project.api.notice.vo.NoticeVO">
		<bind name="beginRow" value="_parameter.beginRowNum - 1" />
		<bind name="itemsPerPage" value="_parameter.endRowNum - _parameter.beginRowNum + 1" />
		/* NoticeMapper.selectNoticeList */
		SELECT
			A.*
		FROM
			(	SELECT
					<include refid="notice-cols" />
					, ROW_NUMBER() OVER() AS ROW_NUM
				FROM
					COMT_NOTICE
				WHERE
					1=1
					<include refid="notice-where" />
			) A
		ORDER BY CREATED_DT DESC
		LIMIT #{beginRow}, #{itemsPerPage}
	</select>
</mapper>